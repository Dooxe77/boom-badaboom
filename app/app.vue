<template>
  <Analytics />
  <div class="min-h-screen bg-gray-50">
    <!-- Header Component -->
    <Header @start-game="openGameModeSelection" />

    <!-- Navigation Component -->
    <Navigation />

    <div class="container mx-auto px-4 sm:px-6 py-8">
      <!-- Concept du Jeu -->
      <!-- ConceptSection Component -->
      <ConceptSection />
      <!-- ContenuSection Component -->
      <ContenuSection />
      <!-- MiseEnPlaceSection Component -->
      <MiseEnPlaceSection />
      <!-- VictoireSection Component -->
      <VictoireSection />
      <!-- CartesSection Component -->
      <CartesSection @card-click="openCardModal" />

      <!-- Mode Coop√©ratif -->
      <section
        id="cooperative-mode"
        class="mb-12 relative overflow-hidden rounded-3xl"
      >
        <div
          class="absolute inset-0 bg-gradient-to-br from-amber-50/30 via-orange-50/30 to-red-50/30"
        ></div>
        <div class="absolute inset-0 opacity-5">
          <div class="absolute top-8 left-8 text-5xl">ü§ñ</div>
          <div class="absolute top-16 right-12 text-3xl">ü§ù</div>
          <div class="absolute bottom-20 left-1/4 text-4xl">‚öôÔ∏è</div>
          <div class="absolute bottom-12 right-1/3 text-2xl">üéÆ</div>
        </div>

        <div
          class="bg-gradient-to-br from-white via-orange-50/30 to-amber-50/50 rounded-3xl shadow-lg border border-orange-100/50 backdrop-blur-sm overflow-hidden relative z-10"
        >
          <div class="p-6 sm:p-10">
            <div class="text-center mb-10">
              <h2
                class="text-3xl sm:text-5xl font-bold bg-gradient-to-r from-orange-600 via-red-600 to-orange-700 bg-clip-text text-transparent mb-4"
              >
                Mode Coop√©ratif
              </h2>
              <div
                class="w-24 h-1 bg-gradient-to-r from-orange-500 to-red-500 rounded-full mx-auto mb-4"
              ></div>
              <p class="text-gray-600 text-lg font-medium">
                1-2 Joueurs ‚Ä¢ Unis contre le fant√¥me farceur
              </p>
            </div>

            <div
              class="bg-gradient-to-br from-orange-50/80 to-red-50/80 backdrop-blur-sm rounded-2xl p-8 border border-orange-200/50 shadow-lg"
            >
              <h3 class="text-2xl font-bold text-gray-800 mb-8 text-center">
                üëª L'Histoire : Le Fant√¥me du Four Ancestral
              </h3>

              <div class="space-y-6 text-gray-700">
                <p class="leading-relaxed">
                  La l√©gende raconte qu'un
                  <strong class="text-purple-600">esprit farceur</strong> hante
                  le vieux four de Mamie Madeleine depuis des g√©n√©rations. Ce
                  fant√¥me espi√®gle, surnomm√© "Fourneau le Fac√©tieux", s'amuse √†
                  jouer des tours aux cuisiniers trop s√©rieux. Aujourd'hui, il a
                  d√©cid√© de
                  <strong class="text-red-600">mettre le chaos</strong> dans la
                  pr√©paration du g√¢teau d'anniversaire !
                </p>

                <div
                  class="bg-white/60 rounded-xl p-6 border border-orange-200"
                >
                  <h4 class="font-bold text-lg text-gray-800 mb-4">
                    Votre Mission :
                  </h4>
                  <p class="mb-4">
                    En tant que membres s√©rieux de la famille, vous devez
                    <strong class="text-blue-600">coop√©rer</strong> pour :
                  </p>
                  <ul class="space-y-3">
                    <li class="flex items-start">
                      <span class="text-orange-500 mr-3 text-xl">üéØ</span>
                      <span
                        >D√©jouer les farces du fant√¥me qui tente de faire
                        surchauffer le four magique</span
                      >
                    </li>
                    <li class="flex items-start">
                      <span class="text-orange-500 mr-3 text-xl">üõ°Ô∏è</span>
                      <span
                        >Maintenir le g√¢teau sous contr√¥le malgr√© les sabotages
                        surnaturels</span
                      >
                    </li>
                    <li class="flex items-start">
                      <span class="text-orange-500 mr-3 text-xl">‚è∞</span>
                      <span
                        >R√©ussir √† finir la recette avant que le four n'explose
                        dans un grand BOOM BADABOOM !</span
                      >
                    </li>
                  </ul>
                </div>

                <p class="leading-relaxed text-center italic text-gray-600">
                  Le fant√¥me joue ses cartes contre vous, tentant de saboter
                  chaque √©tape. Saurez-vous apaiser Fourneau le Fac√©tieux et
                  offrir √† Mamie Madeleine le g√¢teau qu'elle m√©rite ?
                </p>

                <!-- Work in Progress -->
                <div
                  class="bg-gradient-to-r from-yellow-100 to-amber-100 rounded-xl p-6 border-2 border-yellow-400 mt-8"
                >
                  <div class="flex items-center justify-center mb-4">
                    <div
                      class="w-16 h-16 bg-yellow-300 rounded-full flex items-center justify-center"
                    >
                      <span class="text-2xl">üöß</span>
                    </div>
                  </div>
                  <h4
                    class="text-xl font-bold text-yellow-800 text-center mb-3"
                  >
                    Work In Progress
                  </h4>
                  <p class="text-yellow-700 text-center">
                    Ce mode est actuellement en d√©veloppement. Les r√®gles
                    d√©taill√©es et les m√©caniques sp√©cifiques seront bient√¥t
                    disponibles. Restez connect√©s pour d√©couvrir cette nouvelle
                    fa√ßon palpitante de jouer √† Boom Badaboom !
                  </p>
                  <div class="flex justify-center mt-4 space-x-2">
                    <div
                      class="w-3 h-3 bg-yellow-400 rounded-full animate-pulse"
                    ></div>
                    <div
                      class="w-3 h-3 bg-yellow-400 rounded-full animate-pulse"
                      style="animation-delay: 0.2s"
                    ></div>
                    <div
                      class="w-3 h-3 bg-yellow-400 rounded-full animate-pulse"
                      style="animation-delay: 0.4s"
                    ></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Remerciements -->
      <section
        id="remerciements"
        class="mb-12 relative overflow-hidden rounded-3xl"
      >
        <div
          class="absolute inset-0 bg-gradient-to-br from-amber-50/30 via-orange-50/30 to-red-50/30"
        ></div>
        <div class="absolute inset-0 opacity-5">
          <div class="absolute top-8 left-8 text-5xl">üôè</div>
          <div class="absolute top-16 right-12 text-3xl">‚ù§Ô∏è</div>
          <div class="absolute bottom-20 left-1/4 text-4xl">üéâ</div>
          <div class="absolute bottom-12 right-1/3 text-2xl">üëè</div>
        </div>

        <div
          class="bg-gradient-to-br from-white via-orange-50/30 to-amber-50/50 rounded-3xl shadow-lg border border-orange-100/50 backdrop-blur-sm overflow-hidden relative z-10"
        >
          <div class="p-6 sm:p-10">
            <div class="text-center mb-10">
              <h2
                class="text-3xl sm:text-5xl font-bold bg-gradient-to-r from-orange-600 via-red-600 to-orange-700 bg-clip-text text-transparent mb-4"
              >
                Remerciements
              </h2>
              <div
                class="w-24 h-1 bg-gradient-to-r from-orange-500 to-red-500 rounded-full mx-auto mb-4"
              ></div>
              <p class="text-gray-600 text-lg font-medium">
                Merci aux contributeurs qui ont rendu ce jeu possible
              </p>
            </div>

            <div
              class="bg-gradient-to-br from-orange-50/80 to-red-50/80 backdrop-blur-sm rounded-2xl p-8 border border-orange-200/50 shadow-lg"
            >
              <h3 class="text-2xl font-bold text-gray-800 mb-8 text-center">
                Merci aux contributeurs du projet
              </h3>

              <!-- Grille fixe avec taille homog√®ne -->
              <div
                class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4 sm:gap-6 max-w-4xl mx-auto mb-8"
              >
                <!-- Laura Ruelle -->
                <div
                  class="bg-white rounded-lg p-4 sm:p-6 shadow-md border border-gray-200 hover:shadow-lg transition-shadow duration-200"
                >
                  <div class="flex flex-col items-center">
                    <div
                      class="w-12 h-12 sm:w-14 sm:h-14 bg-yellow-500 rounded-lg flex items-center justify-center text-white font-bold text-base sm:text-lg mb-2 sm:mb-3"
                    >
                      LR
                    </div>
                    <h4
                      class="font-semibold text-gray-800 text-center text-xs sm:text-sm leading-tight"
                    >
                      <div>Laura</div>
                      <div>Ruelle</div>
                    </h4>
                  </div>
                </div>

                <!-- Mathieu Lecomte -->
                <div
                  class="bg-white rounded-lg p-4 sm:p-6 shadow-md border border-gray-200 hover:shadow-lg transition-shadow duration-200"
                >
                  <div class="flex flex-col items-center">
                    <div
                      class="w-12 h-12 sm:w-14 sm:h-14 bg-blue-500 rounded-lg flex items-center justify-center text-white font-bold text-base sm:text-lg mb-2 sm:mb-3"
                    >
                      ML
                    </div>
                    <h4
                      class="font-semibold text-gray-800 text-center text-xs sm:text-sm leading-tight"
                    >
                      <div>Mathieu</div>
                      <div>Lecomte</div>
                    </h4>
                  </div>
                </div>

                <!-- Am√©lia Lecomte -->
                <div
                  class="bg-white rounded-lg p-4 sm:p-6 shadow-md border border-gray-200 hover:shadow-lg transition-shadow duration-200"
                >
                  <div class="flex flex-col items-center">
                    <div
                      class="w-12 h-12 sm:w-14 sm:h-14 bg-pink-500 rounded-lg flex items-center justify-center text-white font-bold text-base sm:text-lg mb-2 sm:mb-3"
                    >
                      AL
                    </div>
                    <h4
                      class="font-semibold text-gray-800 text-center text-xs sm:text-sm leading-tight"
                    >
                      <div>Am√©lia</div>
                      <div>Lecomte</div>
                    </h4>
                  </div>
                </div>

                <!-- Malone Lecomte -->
                <div
                  class="bg-white rounded-lg p-4 sm:p-6 shadow-md border border-gray-200 hover:shadow-lg transition-shadow duration-200"
                >
                  <div class="flex flex-col items-center">
                    <div
                      class="w-12 h-12 sm:w-14 sm:h-14 bg-green-500 rounded-lg flex items-center justify-center text-white font-bold text-base sm:text-lg mb-2 sm:mb-3"
                    >
                      MA
                    </div>
                    <h4
                      class="font-semibold text-gray-800 text-center text-xs sm:text-sm leading-tight"
                    >
                      <div>Malone</div>
                      <div>Lecomte</div>
                    </h4>
                  </div>
                </div>

                <!-- Hugues Ruelle -->
                <div
                  class="bg-white rounded-lg p-4 sm:p-6 shadow-md border border-gray-200 hover:shadow-lg transition-shadow duration-200"
                >
                  <div class="flex flex-col items-center">
                    <div
                      class="w-12 h-12 sm:w-14 sm:h-14 bg-purple-500 rounded-lg flex items-center justify-center text-white font-bold text-base sm:text-lg mb-2 sm:mb-3"
                    >
                      HR
                    </div>
                    <h4
                      class="font-semibold text-gray-800 text-center text-xs sm:text-sm leading-tight"
                    >
                      <div>Hugues</div>
                      <div>Ruelle</div>
                    </h4>
                  </div>
                </div>

                <!-- Evelyne Ruelle -->
                <div
                  class="bg-white rounded-lg p-4 sm:p-6 shadow-md border border-gray-200 hover:shadow-lg transition-shadow duration-200"
                >
                  <div class="flex flex-col items-center">
                    <div
                      class="w-12 h-12 sm:w-14 sm:h-14 bg-teal-500 rounded-lg flex items-center justify-center text-white font-bold text-base sm:text-lg mb-2 sm:mb-3"
                    >
                      ER
                    </div>
                    <h4
                      class="font-semibold text-gray-800 text-center text-xs sm:text-sm leading-tight"
                    >
                      <div>Evelyne</div>
                      <div>Ruelle</div>
                    </h4>
                  </div>
                </div>

                <!-- Julie Lecomte -->
                <div
                  class="bg-white rounded-lg p-4 sm:p-6 shadow-md border border-gray-200 hover:shadow-lg transition-shadow duration-200"
                >
                  <div class="flex flex-col items-center">
                    <div
                      class="w-12 h-12 sm:w-14 sm:h-14 bg-orange-500 rounded-lg flex items-center justify-center text-white font-bold text-base sm:text-lg mb-2 sm:mb-3"
                    >
                      JL
                    </div>
                    <h4
                      class="font-semibold text-gray-800 text-center text-xs sm:text-sm leading-tight"
                    >
                      <div>Julie</div>
                      <div>Lecomte</div>
                    </h4>
                  </div>
                </div>

                <!-- Marie Lecomte -->
                <div
                  class="bg-white rounded-lg p-4 sm:p-6 shadow-md border border-gray-200 hover:shadow-lg transition-shadow duration-200"
                >
                  <div class="flex flex-col items-center">
                    <div
                      class="w-12 h-12 sm:w-14 sm:h-14 bg-red-500 rounded-lg flex items-center justify-center text-white font-bold text-base sm:text-lg mb-2 sm:mb-3"
                    >
                      MC
                    </div>
                    <h4
                      class="font-semibold text-gray-800 text-center text-xs sm:text-sm leading-tight"
                    >
                      <div>Marie</div>
                      <div>Lecomte</div>
                    </h4>
                  </div>
                </div>

                <!-- Oscar Verquin -->
                <div
                  class="bg-white rounded-lg p-4 sm:p-6 shadow-md border border-gray-200 hover:shadow-lg transition-shadow duration-200"
                >
                  <div class="flex flex-col items-center">
                    <div
                      class="w-12 h-12 sm:w-14 sm:h-14 bg-indigo-500 rounded-lg flex items-center justify-center text-white font-bold text-base sm:text-lg mb-2 sm:mb-3"
                    >
                      OV
                    </div>
                    <h4
                      class="font-semibold text-gray-800 text-center text-xs sm:text-sm leading-tight"
                    >
                      <div>Oscar</div>
                      <div>Verquin</div>
                    </h4>
                  </div>
                </div>

                <!-- Thibaut Debruille -->
                <div
                  class="bg-white rounded-lg p-4 sm:p-6 shadow-md border border-gray-200 hover:shadow-lg transition-shadow duration-200"
                >
                  <div class="flex flex-col items-center">
                    <div
                      class="w-12 h-12 sm:w-14 sm:h-14 bg-cyan-500 rounded-lg flex items-center justify-center text-white font-bold text-base sm:text-lg mb-2 sm:mb-3"
                    >
                      TD
                    </div>
                    <h4
                      class="font-semibold text-gray-800 text-center text-xs sm:text-sm leading-tight"
                    >
                      <div>Thibaut</div>
                      <div>Debruille</div>
                    </h4>
                  </div>
                </div>

                <!-- Paulyne Meermans -->
                <div
                  class="bg-white rounded-lg p-4 sm:p-6 shadow-md border border-gray-200 hover:shadow-lg transition-shadow duration-200"
                >
                  <div class="flex flex-col items-center">
                    <div
                      class="w-12 h-12 sm:w-14 sm:h-14 bg-rose-500 rounded-lg flex items-center justify-center text-white font-bold text-base sm:text-lg mb-2 sm:mb-3"
                    >
                      PM
                    </div>
                    <h4
                      class="font-semibold text-gray-800 text-center text-xs sm:text-sm leading-tight"
                    >
                      <div>Paulyne</div>
                      <div>Meermans</div>
                    </h4>
                  </div>
                </div>
              </div>

              <!-- Message de remerciement simple -->
              <div class="text-center">
                <div
                  class="bg-white/70 backdrop-blur-sm rounded-xl p-6 border border-orange-200/50"
                >
                  <p class="text-gray-700 font-medium text-lg mb-3">
                    Leurs retours ont permis d'affiner la recette parfaite de ce
                    jeu
                  </p>
                  <p class="text-orange-600 font-bold text-xl">
                    Merci √† toute l'√©quipe ! üë®‚Äçüç≥üéâ
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>

    <!-- Back to top button -->
    <button
      v-show="showBackToTop"
      @click="scrollToTop"
      class="fixed bottom-8 right-8 bg-red-500 hover:bg-red-600 text-white w-12 h-12 rounded-full shadow-lg hover:shadow-xl transition-all duration-300 flex items-center justify-center z-50"
    >
      <svg
        class="w-6 h-6"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M5 10l7-7m0 0l7 7m-7-7v18"
        ></path>
      </svg>
    </button>

    <!-- CounterMode Component -->
    <CounterMode
      :show="showCounterMode"
      :elapsed-time="elapsedTime"
      :player-count="playerCount"
      :turn-number="turnNumber"
      :final-countdown-revealed="finalCountdownRevealed"
      :event-deck-length="eventDeck.length"
      :game-over="gameOver"
      :counter-value="counterValue"
      :threshold-value="thresholdValue"
      :min-threshold="minThreshold"
      :max-threshold="maxThreshold"
      :current-event="currentEvent"
      :is-explosion="isExplosion"
      :show-end-game-modal="showEndGameModal"
      :game-duration="gameDuration"
      @next-turn="finalCountdownRevealed ? endGame() : drawNextEvent()"
      @show-history="showHistoryModal = true"
      @close-confirm="showCloseConfirmModal = true"
      @adjust-counter="adjustCounter"
      @adjust-threshold="adjustThreshold"
      @quit-game="quitGame"
    />

    <!-- Section Contact -->
    <!-- ContactForm Component -->
    <ContactForm />

    <!-- Footer -->
    <footer
      class="bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 text-white text-center py-12 relative overflow-hidden"
    >
      <div class="absolute inset-0 opacity-10">
        <div class="absolute top-4 left-8 text-3xl">üç∞</div>
        <div class="absolute top-8 right-12 text-2xl">üë®‚Äçüç≥</div>
        <div class="absolute bottom-6 left-1/4 text-4xl">üî•</div>
        <div class="absolute bottom-4 right-1/3 text-2xl">üí•</div>
      </div>

      <div class="container mx-auto px-4 sm:px-6 relative z-10">
        <div class="mb-6">
          <h3
            class="text-2xl sm:text-3xl font-bold bg-gradient-to-r from-orange-400 via-red-400 to-orange-500 bg-clip-text text-transparent mb-2"
          >
            Boom Badaboom
          </h3>
          <p class="text-lg font-semibold text-orange-300 mb-3">
            Chaos en Cuisine
          </p>
          <div
            class="w-16 h-1 bg-gradient-to-r from-orange-400 to-red-400 rounded-full mx-auto mb-4"
          ></div>
        </div>

        <p class="text-gray-300 text-base leading-relaxed max-w-md mx-auto">
          Jeu de cartes √† r√¥les cach√©s dans l'univers culinaire
        </p>
        <p class="text-gray-400 text-sm mt-2">Bluff ‚Ä¢ Tension ‚Ä¢ Strat√©gie</p>

        <div class="mt-8 pt-6 border-t border-gray-700">
          <!-- Logo de la maison d'√©dition -->
          <div class="mb-4 text-center">
            <p class="text-gray-400 text-xs mb-2">√âdit√© par</p>
            <div class="inline-block bg-white/90 rounded-lg px-4 py-2">
              <img
                src="/LaRuelleAuxJeuxLogo.png"
                alt="La Ruelle Aux Jeux"
                class="h-10 transition-transform duration-300 hover:scale-105"
              />
            </div>
          </div>
          <p class="text-gray-500 text-sm">
            ¬© {{ getCurrentYear() }} La Ruelle Aux Jeux - Cr√©√© avec passion pour
            les amateurs de jeux de soci√©t√©
          </p>
        </div>
      </div>
    </footer>

    <!-- CardModal Component -->
    <CardModal
      :show="showCardModal"
      :card="selectedCard"
      @close="closeCardModal"
    />

    <!-- HistoryModal Component -->
    <HistoryModal
      :show="showHistoryModal"
      :history="unifiedHistory"
      @close="showHistoryModal = false"
    />

    <!-- Modale Confirmation Fermeture Partie -->
    <div
      v-if="showCloseConfirmModal"
      class="fixed inset-0 z-50 flex items-center justify-center p-2 sm:p-4 bg-black bg-opacity-75"
      @click="cancelCloseGame"
    >
      <div
        class="bg-white rounded-2xl shadow-2xl max-w-sm w-full max-h-[90vh] overflow-y-auto"
        @click.stop
      >
        <div class="p-4 sm:p-6 text-center">
          <div class="text-4xl sm:text-5xl mb-4 sm:mb-4">‚ö†Ô∏è</div>
          <h3 class="text-base sm:text-lg font-bold text-gray-800 mb-4 sm:mb-4">
            Quitter la partie ?
          </h3>
          <p class="text-sm sm:text-base text-gray-600 mb-4 sm:mb-6">
            √ätes-vous s√ªr de vouloir fermer la partie en cours ?
            <strong>Toutes les donn√©es seront perdues.</strong>
          </p>
          <div class="flex space-x-2 sm:space-x-3">
            <button
              @click="cancelCloseGame"
              class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 sm:py-3 px-3 sm:px-4 rounded-lg transition-colors text-sm sm:text-base"
            >
              Annuler
            </button>
            <button
              @click="confirmCloseGame"
              class="flex-1 bg-red-500 hover:bg-red-600 text-white font-bold py-2 sm:py-3 px-3 sm:px-4 rounded-lg transition-colors text-sm sm:text-base"
            >
              ‚úï Quitter
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- GameModeModal Component -->
  <GameModeModal
    :show="showGameModeModal"
    @close="closeGameModeModal"
    @select-competitive="selectCompetitiveMode"
    @select-cooperative="selectCooperativeMode"
  />

  <!-- Modale S√©lection Difficult√© IA -->
  <div
    v-if="showAIDifficultyModal"
    class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-75"
    @click="closeAIDifficultyModal"
  >
    <div
      class="bg-white rounded-2xl shadow-2xl max-w-lg w-full overflow-hidden transform transition-all duration-300 scale-100"
      @click.stop
    >
      <!-- Header -->
      <div class="bg-gradient-to-r from-blue-500 to-indigo-500 p-6 text-center">
        <h3 class="text-xl font-bold text-white mb-2">
          üéØ Choisissez la Difficult√©
        </h3>
        <p class="text-blue-100 text-sm">Affrontez Fourneau le Fac√©tieux</p>
      </div>
      <!-- Content -->
      <div class="p-6 space-y-3">
        <div
          v-for="difficulty in aiDifficultyLevels"
          :key="difficulty.name"
          @click="selectAIDifficulty(difficulty)"
          class="w-full group cursor-pointer rounded-xl p-4 transition-all duration-300 hover:scale-[1.02] hover:shadow-lg border-2 border-transparent hover:border-opacity-50"
          :class="{
            'bg-gradient-to-r from-green-50 to-green-100 hover:from-green-100 hover:to-green-200 hover:border-green-400':
              difficulty.color === 'green',
            'bg-gradient-to-r from-blue-50 to-blue-100 hover:from-blue-100 hover:to-blue-200 hover:border-blue-400':
              difficulty.color === 'blue',
            'bg-gradient-to-r from-orange-50 to-orange-100 hover:from-orange-100 hover:to-orange-200 hover:border-orange-400':
              difficulty.color === 'orange',
            'bg-gradient-to-r from-red-50 to-red-100 hover:from-red-100 hover:to-red-200 hover:border-red-400':
              difficulty.color === 'red',
            'bg-gradient-to-r from-purple-50 to-purple-100 hover:from-purple-100 hover:to-purple-200 hover:border-purple-400':
              difficulty.color === 'purple',
          }"
        >
          <div class="flex items-center justify-between">
            <div class="text-left flex-1">
              <div
                class="font-bold text-lg mb-1"
                :class="{
                  'text-green-800': difficulty.color === 'green',
                  'text-blue-800': difficulty.color === 'blue',
                  'text-orange-800': difficulty.color === 'orange',
                  'text-red-800': difficulty.color === 'red',
                  'text-purple-800': difficulty.color === 'purple',
                }"
              >
                {{ difficulty.name }}
              </div>
              <div
                class="text-sm opacity-80"
                :class="{
                  'text-green-700': difficulty.color === 'green',
                  'text-blue-700': difficulty.color === 'blue',
                  'text-orange-700': difficulty.color === 'orange',
                  'text-red-700': difficulty.color === 'red',
                  'text-purple-700': difficulty.color === 'purple',
                }"
              >
                {{ difficulty.turns }} tours ‚Ä¢ Capacit√© du four
                {{ difficulty.threshold }} ‚Ä¢ Taux de victoire moyen
                {{ difficulty.winRate }}
              </div>
            </div>
            <div
              class="text-xl opacity-70 group-hover:opacity-100 transition-opacity"
              :class="{
                'text-green-600': difficulty.color === 'green',
                'text-blue-600': difficulty.color === 'blue',
                'text-orange-600': difficulty.color === 'orange',
                'text-red-600': difficulty.color === 'red',
                'text-purple-600': difficulty.color === 'purple',
              }"
            >
              üéØ
            </div>
          </div>
        </div>
      </div>

      <!-- Bouton retour -->
      <div class="p-6 pt-0">
        <button
          @click="
            closeAIDifficultyModal();
            openGameModeSelection();
          "
          class="w-full p-3 bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium rounded-xl transition-colors duration-200"
        >
          ‚Üê Retour
        </button>
      </div>
    </div>
  </div>

  <!-- AIMode Component -->
  <AIMode
    :show="showAIMode"
    :selected-difficulty="selectedDifficulty"
    @close="closeAIMode"
  />

  <!-- EventCard Component -->
  <EventCard
    :show="showEventModal"
    :event="currentEvent"
    :turn-number="turnNumber"
    :pulse="eventModalPulse"
    @close="closeEventModal"
  />

  <!-- Modale Fin de Partie -->
  <div
    v-if="showEndGameModal"
    class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-85"
  >
    <div
      class="bg-gradient-to-br from-gray-800 to-gray-900 border-2 border-yellow-400 rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto"
    >
      <!-- Header -->
      <div
        class="bg-gradient-to-r from-yellow-500 to-orange-500 p-6 text-center"
      >
        <div class="text-4xl mb-4">üèÜ</div>
        <h3 class="text-2xl font-bold text-white mb-2">Fin de Partie !</h3>
        <p class="text-yellow-100 text-sm">Le "Minuteur final" a √©t√© r√©v√©l√©</p>
      </div>

      <!-- Content -->
      <div class="p-6 space-y-6">
        <!-- Temps de partie -->
        <div
          class="text-center bg-gray-700 rounded-xl p-4 border border-gray-600"
        >
          <div class="text-yellow-400 text-sm font-medium mb-2">
            ‚è±Ô∏è Temps de partie
          </div>
          <div class="text-white text-2xl font-bold">
            {{ gameDuration || "Non disponible" }}
          </div>
        </div>

        <!-- Conditions de victoire -->
        <div class="bg-gray-700 rounded-xl p-6 border border-gray-600">
          <h4 class="text-xl font-bold text-yellow-400 mb-4 text-center">
            üéØ Conditions de Victoire par R√¥le
          </h4>

          <div class="grid gap-6 md:grid-cols-2">
            <!-- P√¢tissiers -->
            <div
              class="bg-gradient-to-br from-blue-600 to-blue-700 rounded-xl p-4 text-center"
            >
              <div class="text-2xl mb-4">üë©‚Äçüç≥</div>
              <h5 class="text-lg font-bold text-white mb-4">P√ÇTISSIERS</h5>
              <div class="text-blue-100 text-sm space-y-2">
                <div class="font-semibold text-blue-200">
                  Victoire par R√©ussite :
                </div>
                <div>‚Ä¢ Le g√¢teau est parfait (pas d'explosion)</div>
                <div>‚Ä¢ Le Glouton n'a pas vol√© le g√¢teau</div>
              </div>
            </div>

            <!-- Glouton -->
            <div
              class="bg-gradient-to-br from-yellow-600 to-yellow-700 rounded-xl p-4 text-center"
            >
              <div class="text-2xl mb-4">üòã</div>
              <h5 class="text-lg font-bold text-white mb-4">GLOUTON</h5>
              <div class="text-yellow-100 text-sm space-y-2">
                <div class="font-semibold text-yellow-200">
                  Victoire imm√©diate si :
                </div>
                <div>‚Ä¢ √Ä son tour seulement !</div>
                <div>‚Ä¢ Poss√®de au moins 2 cartes objectifs glouton</div>
                <div>‚Ä¢ ET la taille du g√¢teau est entre 15-18</div>
              </div>
            </div>
          </div>

          <div
            class="mt-4 bg-red-900 bg-opacity-50 rounded-lg p-4 border border-red-500"
          >
            <p class="text-red-200 text-sm text-center">
              ‚ö†Ô∏è Les Farceurs ne peuvent plus gagner car le temps est √©coul√©
            </p>
          </div>
        </div>

        <!-- Boutons -->
        <div class="flex justify-center pt-4">
          <button
            @click="quitGame"
            class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-8 rounded-lg transition-colors"
          >
            ‚úï Quitter la partie
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modale S√©lection Nombre de Joueurs -->
  <div
    v-if="showPlayerCountModal"
    class="fixed inset-0 z-50 bg-black bg-opacity-75 flex items-center justify-center p-4"
  >
    <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-8">
      <div class="text-center mb-6">
        <div
          class="w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full mx-auto mb-4 flex items-center justify-center"
        >
          <svg
            class="w-8 h-8 text-white"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m3 5.197H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"
            ></path>
          </svg>
        </div>
        <h2 class="text-2xl font-bold text-gray-800 mb-2">Mode R√¥les cach√©s</h2>
        <p class="text-gray-600">S√©lectionnez le nombre de joueurs</p>
      </div>

      <div class="space-y-3">
        <button
          @click="selectPlayerCount(3)"
          class="w-full p-4 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200 flex items-center justify-between"
        >
          <span>3 Joueurs</span>
          <div class="flex space-x-1">
            <div class="w-3 h-3 bg-white rounded-full opacity-80"></div>
            <div class="w-3 h-3 bg-white rounded-full opacity-80"></div>
            <div class="w-3 h-3 bg-white rounded-full opacity-80"></div>
          </div>
        </button>
        <button
          @click="selectPlayerCount(4)"
          class="w-full p-4 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200 flex items-center justify-between"
        >
          <span>4 Joueurs</span>
          <div class="flex space-x-1">
            <div class="w-3 h-3 bg-white rounded-full opacity-80"></div>
            <div class="w-3 h-3 bg-white rounded-full opacity-80"></div>
            <div class="w-3 h-3 bg-white rounded-full opacity-80"></div>
            <div class="w-3 h-3 bg-white rounded-full opacity-80"></div>
          </div>
        </button>
        <button
          @click="selectPlayerCount(5)"
          class="w-full p-4 bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200 flex items-center justify-between"
        >
          <span>5 Joueurs</span>
          <div class="flex space-x-1">
            <div class="w-3 h-3 bg-white rounded-full opacity-80"></div>
            <div class="w-3 h-3 bg-white rounded-full opacity-80"></div>
            <div class="w-3 h-3 bg-white rounded-full opacity-80"></div>
            <div class="w-3 h-3 bg-white rounded-full opacity-80"></div>
            <div class="w-3 h-3 bg-white rounded-full opacity-80"></div>
          </div>
        </button>
      </div>

      <button
        @click="
          closePlayerCountModal();
          openGameModeSelection();
        "
        class="w-full mt-6 p-3 bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium rounded-xl transition-colors duration-200"
      >
        ‚Üê Retour
      </button>
    </div>
  </div>
</template>

<style scoped>
/* Custom cursor for images */
.cursor-zoom-in {
  cursor: zoom-in;
}

/* Custom sizes for tokens */
.w-18 {
  width: 4.5rem;
}
.h-18 {
  height: 4.5rem;
}
.shadow-3xl {
  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25),
    0 0 30px rgba(0, 0, 0, 0.15);
}

/* Modal scroll improvements for mobile */
.max-h-\[90vh\] {
  max-height: 90vh;
}

@media (max-height: 600px) {
  .max-h-\[90vh\] {
    max-height: 95vh;
  }
}

/* Custom arrow border sizes */
.border-l-3 {
  border-left-width: 6px;
}
.border-r-3 {
  border-right-width: 6px;
}
.border-t-5 {
  border-top-width: 8px;
}

/* Enhanced glow effects */
.token-glow-blue {
  filter: drop-shadow(0 0 15px rgba(59, 130, 246, 0.7));
}
.token-glow-yellow {
  filter: drop-shadow(0 0 18px rgba(234, 179, 8, 0.8));
}
.token-glow-red {
  filter: drop-shadow(0 0 25px rgba(239, 68, 68, 0.9));
}
</style>

<script setup>
import { ref, computed, onMounted, onUnmounted } from "vue";
import { Analytics } from "@vercel/analytics/vue";

// Fonction pour g√©rer les images manquantes
const handleImageError = (event) => {
  event.target.src = "/placeholder-card.png";
  event.target.onerror = null; // √âviter les boucles infinies
};

// Navigation
const navLinks = [
  { id: "concept", label: "Concept" },
  { id: "contenu", label: "Contenu" },
  { id: "mise-en-place", label: "Mise en Place" },
  { id: "deroulement", label: "D√©roulement" },
  { id: "victoire", label: "Victoire" },
  { id: "cartes", label: "Mat√©riel" },
  { id: "faq", label: "FAQ" },
  { id: "cooperative-mode", label: "Mode Coop√©ratif" },
  { id: "remerciements", label: "Remerciements" },
  { id: "contact", label: "Contact" },
];

// Cards data

const actionCards = [
  {
    name: "Coup d'oeil gourmand",
    type: "Action",
    effect:
      "Regardez secr√®tement la main d'un joueur et volez une carte au choix",
    quantity: 3,
    image: "/placeholder-card.png",
  },
  {
    name: "Accident de cuisine",
    type: "Action",
    effect: "Un joueur de votre choix passe compl√®tement son prochain tour",
    quantity: 3,
    image: "/placeholder-card.png",
  },
  {
    name: "Maladresse",
    type: "Action",
    effect:
      "Un joueur de votre choix doit jouer une carte au hasard de sa main",
    quantity: 2,
    image: "/placeholder-card.png",
  },
  {
    name: "Four √©largi",
    type: "Action",
    effect: "Augmentez la capacit√© du four d'une valeur myst√®re",
    quantity: 3,
    image: "/placeholder-card.png",
  },
  {
    name: "Four r√©tr√©ci",
    type: "Action",
    effect: "Diminuez la capacit√© du four d'une valeur myst√®re",
    quantity: 3,
    image: "/placeholder-card.png",
  },
  {
    name: "R√©cup√©ration d'ingr√©dient",
    type: "Action",
    effect: "Reprenez une carte au choix dans la d√©fausse",
    quantity: 4,
    image: "/placeholder-card.png",
  },
  {
    name: "√âchange de Tablier",
    type: "Action",
    effect: "√âchangez votre main avec celle d'un joueur de ton choix",
    quantity: 1,
    image: "/placeholder-card.png",
  },
  {
    name: "Inspection du frigo",
    type: "Action",
    effect: "Regardez les 3 prochaines cartes de la pioche et changez l'ordre",
    quantity: 1,
    image: "/placeholder-card.png",
  },
  {
    name: "Pinc√©e de hasard",
    type: "Action",
    effect:
      "Piochez une carte de valeur al√©atoire et modifiez la taille du g√¢teau : 1 ou 2 = +3 / 3 = 0 / 4 ou 5 = -3",
    quantity: 1,
    image: "/placeholder-card.png",
  },
  {
    name: "Changement de toque",
    type: "Action",
    effect: "√âchangez votre carte R√¥le avec celle face cach√©e",
    quantity: 1,
    image: "/placeholder-card.png",
  },
  {
    name: "Nettoyage complet",
    type: "Action",
    effect: "D√©faussez toutes vos cartes et piochez-en le m√™me nombre",
    quantity: 1,
    image: "/placeholder-card.png",
  },
  {
    name: "Remixage total",
    type: "Action",
    effect:
      "M√©langez toutes les cartes en main avec la d√©fausse. Redistribuez 5 cartes par joueur",
    quantity: 1,
    image: "/placeholder-card.png",
  },
];

// Setup steps
const setupSteps = [
  "<strong>S√©parez les cartes syst√®me du reste</strong> (r√¥les, √©v√©nements, premier joueur)",
  "<strong>S√©lectionnez les cartes selon le nombre de joueurs :</strong><span class='block mt-2'>‚Ä¢ <strong>3 joueurs :</strong> Prenez uniquement les cartes marqu√©es 3+</span><span class='block'>‚Ä¢ <strong>4 joueurs :</strong> Ajoutez les cartes marqu√©es 4+</span><span class='block'>‚Ä¢ <strong>5 joueurs :</strong> Ajoutez aussi les cartes marqu√©es 5+</span><span class='block mt-2'><em>Les indicateurs se trouvent en haut √† droite des cartes</em></span>",
  "<strong>M√©langez toutes les cartes de jeu s√©l√©ctionn√©es</strong>",
  "Chaque joueur re√ßoit <strong>5 cartes</strong>",
  "<strong>Placez le plateau de jeu</strong> au centre de la table <span class='text-blue-600 text-sm'>(<em>Peut √™tre pass√© si vous utilisez l'application</em>)</span>",
  "Placez le jeton <strong>taille du g√¢teau sur le nombre de joueurs</strong> (3, 4 ou 5) et le jeton <strong>capacit√© du four sur 20</strong> <span class='text-blue-600 text-sm'>(<em>Peut √™tre pass√© si vous utilisez l'application</em>)</span>",
  '<strong>D√©signez le premier joueur</strong> et donnez-lui la carte "Premier Joueur" qu\'il place devant lui',
  '<strong>Pr√©parez les √©v√©nements :</strong><span class="block mt-2">‚Ä¢ Piochez 9 cartes √âv√©nement au hasard (hors Minuteur final)</span><span class="block">‚Ä¢ Prenez 2 cartes au hasard de ce paquet + la carte "Minuteur final"</span><span class="block">‚Ä¢ M√©langez ces 3 cartes et placez-les <strong>sous la pile</strong> d\'√©v√©nements</span><span class="block mt-2"><span class="text-blue-600 text-sm">(<em>Peut √™tre pass√© si vous utilisez l\'application</em>)</span></span>',
  "<strong>Distribuez les r√¥les</strong> selon le tableau de r√©partition avec incertitude :<div class='mt-4'></div><div class='bg-gradient-to-r from-yellow-50 to-orange-50 p-3 sm:p-4 rounded-lg border-l-4 border-yellow-400 mb-4'><div class='text-sm text-yellow-800'><strong>üé≠ Principe :</strong> Prenez plus de cartes r√¥les que de joueurs, m√©langez-les et distribuez-en une par joueur. La carte non distribu√©e reste secr√®te, cr√©ant de l'incertitude sur la composition exacte.</div></div><div class='overflow-x-auto -mx-4 sm:mx-0 px-4 sm:px-0'><div class='inline-block min-w-full'><table class='min-w-full border-collapse bg-white shadow-lg rounded-lg overflow-hidden'><thead><tr class='bg-gradient-to-r from-red-500 to-orange-500 text-white'><th class='border border-gray-200 px-2 py-3 sm:px-4 sm:py-3 font-bold text-xs sm:text-sm text-left'>Joueurs</th><th class='border border-gray-200 px-2 py-3 sm:px-4 sm:py-3 font-bold text-xs sm:text-sm text-left'>Cartes</th><th class='border border-gray-200 px-2 py-3 sm:px-4 sm:py-3 font-bold text-xs sm:text-sm text-left'>Composition</th><th class='border border-gray-200 px-2 py-3 sm:px-4 sm:py-3 font-bold text-xs sm:text-sm text-left'>Distribu√©es</th></tr></thead><tbody><tr class='bg-gray-50'><td class='border border-gray-200 px-2 py-2 sm:px-4 sm:py-3 font-bold text-red-600 text-xs sm:text-sm'>3</td><td class='border border-gray-200 px-2 py-2 sm:px-4 sm:py-3 text-xs sm:text-sm'>4 cartes</td><td class='border border-gray-200 px-2 py-2 sm:px-4 sm:py-3 text-xs sm:text-sm'>2 P√¢tissiers + 1 Farceur + 1 Glouton</td><td class='border border-gray-200 px-2 py-2 sm:px-4 sm:py-3 font-semibold text-green-600 text-xs sm:text-sm'>3 <span class='text-gray-500 text-xs block sm:inline'>(1 retir√©e)</span></td></tr><tr class='bg-white'><td class='border border-gray-200 px-2 py-2 sm:px-4 sm:py-3 font-bold text-red-600 text-xs sm:text-sm'>4</td><td class='border border-gray-200 px-2 py-2 sm:px-4 sm:py-3 text-xs sm:text-sm'>5 cartes</td><td class='border border-gray-200 px-2 py-2 sm:px-4 sm:py-3 text-xs sm:text-sm'>2 P√¢tissiers + 2 Farceurs + 1 Glouton</td><td class='border border-gray-200 px-2 py-2 sm:px-4 sm:py-3 font-semibold text-green-600 text-xs sm:text-sm'>4 <span class='text-gray-500 text-xs block sm:inline'>(1 retir√©e)</span></td></tr><tr class='bg-gray-50'><td class='border border-gray-200 px-2 py-2 sm:px-4 sm:py-3 font-bold text-red-600 text-xs sm:text-sm'>5</td><td class='border border-gray-200 px-2 py-2 sm:px-4 sm:py-3 text-xs sm:text-sm'>6 cartes</td><td class='border border-gray-200 px-2 py-2 sm:px-4 sm:py-3 text-xs sm:text-sm'>2 P√¢tissiers + 3 Farceurs + 1 Glouton</td><td class='border border-gray-200 px-2 py-2 sm:px-4 sm:py-3 font-semibold text-green-600 text-xs sm:text-sm'>5 <span class='text-gray-500 text-xs block sm:inline'>(1 retir√©e)</span></td></tr></tbody></table></div></div>",
];

// Game steps
const gameSteps = [
  "<strong>R√©v√©lez un √©v√©nement</strong> (au d√©but du tour du premier joueur uniquement)",
  "<strong>Jouez 1 carte</strong> de votre main",
  "<strong>Appliquez l'effet</strong> de la carte (modification du compteur, action sp√©ciale...)",
  "<strong>Piochez autant de carte que n√©cessaire</strong> pour revenir √† 5 cartes en main (sauf si votre tour est saut√©)",
  "<strong>Fin de manche :</strong> Une fois que tous les joueurs ont jou√©, la carte Premier Joueur passe au joueur de gauche et on d√©voile un nouvel √©v√©nement",
];

// Events
const events = [
  {
    name: "√âchange d'Ingr√©dients",
    effect: "Tous les joueurs passent leur main au joueur √† leur gauche",
    image: "/placeholder-card.png",
  },
  {
    name: "Four en panne",
    effect: "Personne ne pioche √† la fin de son tour ce tour-ci",
    image: "/placeholder-card.png",
  },
  {
    name: "Inventaire surprise",
    effect: "Tous les joueurs r√©v√®lent 1 carte au hasard de leur main",
    image: "/placeholder-card.png",
  },
  {
    name: "Cuisine ouverte",
    effect: "Pendant ce tour, toutes les cartes pioch√©es doivent √™tre r√©v√©l√©es",
    image: "/placeholder-card.png",
  },
  {
    name: "Four d√©r√©gl√©",
    effect:
      "Les effets des cartes influant sur la piste sont invers√©s (les + deviennent des - et les - des +)",
    image: "/placeholder-card.png",
  },
  {
    name: "√âclaboussures",
    effect:
      "Si une carte refroidissement est jou√©e, le joueur d√©voile une carte de la pioche et applique son effet imm√©diatement",
    image: "/placeholder-card.png",
  },
  {
    name: "Double intensit√©",
    effect:
      "Chaque carte chaleur/refroidissement üå°Ô∏è compte double (Coup de Boost interdite ce tour)",
    image: "/placeholder-card.png",
  },
  {
    name: "Maladresse",
    effect:
      "Ce tour, apr√®s avoir jou√© votre carte, d√©faussez imm√©diatement une autre carte de votre main au hasard",
    image: "/placeholder-card.png",
  },
  {
    name: "Panne d'√©lectricit√©",
    effect: "Toutes les cartes actions üîß ‚ö° sont interdites ce tour",
    image: "/placeholder-card.png",
  },
  {
    name: "Service express",
    effect:
      "√Ä son tour, chaque joueur pioche une carte et la joue imm√©diatement",
    image: "/placeholder-card.png",
  },
  {
    name: "Cuisine en d√©sordre",
    effect: "L'ordre de jeu s'inverse pour le reste de ce tour",
    image: "/placeholder-card.png",
  },
  {
    name: "Gonflement progressif",
    effect:
      "√Ä la fin du tour de chaque joueur qui joue, la taille du g√¢teau augmente de 1",
    image: "/placeholder-card.png",
  },
  {
    name: "Ventilation d'urgence",
    effect:
      "Si la taille du g√¢teau est √† plus de 15 √† la fin du tour, retirer 3",
    image: "/placeholder-card.png",
  },
  {
    name: "R√©chauffage automatique",
    effect:
      "Si la taille du g√¢teau est √† moins de 10 √† la fin du tour, ajouter 2",
    image: "/placeholder-card.png",
  },
  {
    name: "Minuteur final",
    effect:
      "Dernier tour ! Chaque joueur joue une derni√®re fois, puis la partie s'arr√™te",
    image: "/placeholder-card.png",
  },
];

// AI difficulty levels
const aiDifficultyLevels = [
  {
    name: "üßÅ Cupcake (Tr√®s facile)",
    turns: 7,
    threshold: 19,
    winRate: "90%",
    color: "green",
  },
  {
    name: "üç∞ G√©noise (Facile)",
    turns: 8,
    threshold: 17,
    winRate: "70%",
    color: "blue",
  },
  {
    name: "üéÇ √âclair (Moyen)",
    turns: 11,
    threshold: 15,
    winRate: "40%",
    color: "orange",
  },
  {
    name: "üçÆ Tarte Tatin (Difficile)",
    turns: 13,
    threshold: 12,
    winRate: "15%",
    color: "red",
  },
  {
    name: "üë®‚Äçüç≥ Pi√®ce Mont√©e (Tr√®s difficile)",
    turns: 15,
    threshold: 10,
    winRate: "5%",
    color: "purple",
  },
];

// FAQs
const faqs = [
  {
    question:
      "Que se passe-t-il si la taille du g√¢teau devrait descendre sous 0 ?",
    answer:
      "<strong>La taille du g√¢teau ne peut jamais descendre sous 0.</strong> Si une carte devait le faire descendre en dessous, il reste √† 0.",
  },
  {
    question: "Puis-je regarder la d√©fausse ?",
    answer:
      '<strong>Non.</strong> Il est interdit de fouiller la d√©fausse. Seule la derni√®re carte pos√©e sur la pile de d√©fausse est visible de tous. Le seul moyen de voir le contenu de la d√©fausse est via une carte Action comme "R√©cup√©ration d‚Äôingr√©dient".',
  },
  {
    question:
      "Que se passe-t-il si je dois jouer une carte mais que ma main est vide ?",
    answer:
      "Si vous n'avez aucune carte en main (situation tr√®s rare), vous passez votre tour et piochez imm√©diatement pour reconstituer votre main.",
  },
  {
    question: "Puis-je jouer plusieurs cartes r√©actives ‚ö° en m√™me temps ?",
    answer:
      '<strong>Non.</strong> Les cartes r√©actives se jouent une par une. Une carte r√©active peut contrer une autre carte r√©active, cr√©ant une "cha√Æne" de r√©actions.',
  },
  {
    question: "Four r√©tr√©ci - R√®gles importantes",
    answer:
      "<span class='block'>‚Ä¢ Cette carte <strong>ne peut jamais</strong> d√©clencher l'explosion</span><span class='block'>‚Ä¢ La nouvelle capacit√© du four doit √™tre <strong>au minimum</strong> √† (taille du g√¢teau actuel + 1)</span><span class='block'>‚Ä¢ Le montant de r√©duction est d√©termin√© par une carte num√©rot√©e tir√©e au hasard</span><span class='block'>‚Ä¢ Si la r√©duction diminuerait la capacit√© du four trop bas, la carte ne peut pas √™tre jou√©e</span>",
  },
  {
    question: "Comment fonctionne la carte Renvoi de spatule ?",
    answer:
      "La carte Renvoi de spatule peut :<span class='block mt-2'>‚Ä¢ <strong>Rediriger une action</strong> dirig√©e contre vous vers son auteur</span><span class='block'>‚Ä¢ <strong>Inverser le signe</strong> d'une carte refroidissement/chaleur (+ devient -, - devient +)</span>",
  },
  {
    question: "Peut-on jouer Coup de boost sur une carte Renvoi de spatule ?",
    answer:
      "<strong>Non.</strong> La carte Coup de boost ne peut pas √™tre jou√©e sur une carte Renvoi de spatule. Le Renvoi de spatule est une carte r√©active sp√©ciale qui ne peut pas √™tre surcharg√©e.",
  },
  {
    question: "Maladresse et cartes objectif",
    answer:
      "Si la carte jou√©e au hasard par Maladresse est une <strong>carte objectif du Glouton</strong> (Cerises confites, Spirale de caramel, Macarons dor√©s, Rosace de chantilly, Bonbons g√©lifi√©s), elle est <strong>d√©fauss√©e sans effet</strong>.",
  },
  {
    question: "Que faire si je ne peux pas ou ne veux pas jouer de carte ?",
    answer:
      "<span class='block mb-2'><strong>Si aucune carte de votre main ne peut √™tre jou√©e :</strong> D√©faussez une carte de votre choix.</span><span class='block'><strong>Si vous pouvez jouer au moins une carte :</strong> Vous √™tes <strong>oblig√©(e) de la jouer</strong>, m√™me si cela ne vous arrange pas strat√©giquement.</span>",
  },
  {
    question: "Comment distribuer les cartes avec Remixage total ?",
    answer:
      "Apr√®s avoir m√©lang√© toutes les cartes des mains et de la d√©fausse :<span class='block mt-2'>‚Ä¢ Distribuez <strong>1 carte √† la fois</strong> en tournant dans le sens des aiguilles d'une montre</span><span class='block'>‚Ä¢ Continuez jusqu'√† ce que chaque joueur ait <strong>5 cartes</strong></span><span class='block'>‚Ä¢ <strong>S'il n'y a pas assez de cartes</strong> dans la pile, distribuez tout de m√™me jusqu'√† √©puisement (certains joueurs peuvent avoir moins de 5 cartes)</span>",
  },
];

// Back to top functionality
const showBackToTop = ref(false);

// Card modal functionality
const selectedCard = ref(null);
const showCardModal = ref(false);

// Mobile menu functionality
const isMobileMenuOpen = ref(false);
// Counter mode functionality
const showCounterMode = ref(false);
const playerCount = ref(3); // Nombre de joueurs (3, 4 ou 5)
const counterValue = ref(0);
const thresholdValue = ref(20);
const minThreshold = ref(10);
const maxThreshold = ref(30);
const counterHistory = ref([]);
const showExplosion = ref(false);
const gameOver = ref(false);
const isExplosion = ref(false);
const showHistoryModal = ref(false);
const gameStartTime = ref(null);
const gameDuration = ref(null);
const currentTime = ref(Date.now());

// Event system
const currentEvent = ref(null);
const eventDeck = ref([]);
const usedEvents = ref([]);
const turnNumber = ref(0);
const showEventModal = ref(false);
const eventModalPulse = ref(false);
const showGameStartModal = ref(false);
const finalCountdownRevealed = ref(false);
const showCloseConfirmModal = ref(false);
const showEndGameModal = ref(false);

// Game mode selection
const showGameModeModal = ref(false);
const showPlayerCountModal = ref(false);

// AI mode functionality
const showAIMode = ref(false);
const showAIDifficultyModal = ref(false);
const aiTurnNumber = ref(0);
const aiCounterValue = ref(0);
const aiThresholdValue = ref(20);
const aiCounterHistory = ref([]);
const aiGameOver = ref(false);
const aiShowExplosion = ref(false);
const aiGameStartTime = ref(null);
const aiGameDuration = ref(null);
const showAIHistoryModal = ref(false);
const selectedDifficulty = ref(null);
const currentAICard = ref(null);
const showAICardModal = ref(false);

// Timer interval reference for cleanup
let timerInterval = null;

// Computed property for current elapsed time
const elapsedTime = computed(() => {
  if (!gameStartTime.value || gameOver.value) return null;
  const elapsed = Math.max(0, currentTime.value - gameStartTime.value);
  return formatDuration(elapsed);
});

// Computed property for unified history (events + counter changes)
const unifiedHistory = computed(() => {
  const allItems = [...usedEvents.value, ...counterHistory.value];

  // Sort by timestamp (convert to comparable format)
  return allItems.sort((a, b) => {
    const timeA = new Date(`1970-01-01 ${a.timestamp}`);
    const timeB = new Date(`1970-01-01 ${b.timestamp}`);
    return timeA - timeB;
  });
});

// Contact form
const isSubmitting = ref(false);
const submitMessage = ref("");
const submitSuccess = ref(false);

const handleScroll = () => {
  showBackToTop.value = window.pageYOffset > 300;
};

const scrollToTop = () => {
  window.scrollTo({
    top: 0,
    behavior: "smooth",
  });
};

// Get current year
const getCurrentYear = () => {
  return new Date().getFullYear();
};

// Card modal functions
const openCardModal = (cardImage, cardName) => {
  // Use placeholder if image doesn't exist
  const imagePath = cardImage || "/placeholder-card.png";
  selectedCard.value = { image: imagePath, name: cardName };
  showCardModal.value = true;
  document.body.style.overflow = "hidden";
};

const closeCardModal = () => {
  showCardModal.value = false;
  selectedCard.value = null;
  document.body.style.overflow = "auto";
};

// Mobile menu functions
const toggleMobileMenu = () => {
  isMobileMenuOpen.value = !isMobileMenuOpen.value;
};

const closeMobileMenu = () => {
  isMobileMenuOpen.value = false;
};

// Counter mode functions
const openCounterMode = () => {
  showCounterMode.value = true;

  // Initialize counter values
  counterValue.value = playerCount.value;
  thresholdValue.value = 20;
  counterHistory.value = [];
  showExplosion.value = false;
  gameOver.value = false;
  isExplosion.value = false;
  gameStartTime.value = null;
  gameDuration.value = null;

  // Initialize event system
  currentEvent.value = null;
  usedEvents.value = [];
  turnNumber.value = 0;
  showEventModal.value = false;
  showGameStartModal.value = true;
  eventModalPulse.value = false;
  finalCountdownRevealed.value = false;
  showCloseConfirmModal.value = false;
  showEndGameModal.value = false;
  initializeEventDeck();

  document.body.style.overflow = "hidden";
  // Timer will start when user clicks "C'est parti!"
};

const closeCounterMode = () => {
  showCounterMode.value = false;
  document.body.style.overflow = "auto";
};

const quitGame = () => {
  // Fermer toutes les modals
  showCounterMode.value = false;
  showEndGameModal.value = false;
  showHistoryModal.value = false;
  showEventModal.value = false;
  showPlayerCountModal.value = false;

  // Remettre √† z√©ro tous les √©tats du jeu
  counterValue.value = playerCount.value;
  thresholdValue.value = 20;
  minThreshold.value = 10;
  maxThreshold.value = 30;
  counterHistory.value = [];
  showExplosion.value = false;
  gameOver.value = false;
  gameStartTime.value = null;
  gameDuration.value = null;

  // Remettre √† z√©ro le syst√®me d'√©v√©nements
  currentEvent.value = null;
  eventDeck.value = [];
  usedEvents.value = [];

  // Restaurer le scroll
  document.body.style.overflow = "auto";
};

const triggerExplosion = () => {
  gameOver.value = true;
  isExplosion.value = true;

  // Calculer la dur√©e de la partie
  if (gameStartTime.value) {
    const duration = Date.now() - gameStartTime.value;
    gameDuration.value = formatDuration(duration);
  }

  // Aller directement √† la modale de fin de partie sans √©cran interm√©diaire
  showExplosion.value = false;
};

const formatDuration = (ms) => {
  // Ensure we never have negative time
  const safeDuration = Math.max(0, ms);
  const seconds = Math.floor(safeDuration / 1000);
  const minutes = Math.floor(seconds / 60);
  const remainingSeconds = seconds % 60;

  if (minutes > 0) {
    return `${minutes}m ${remainingSeconds.toString().padStart(2, "0")}s`;
  }
  return `${remainingSeconds}s`;
};

// Contact form handling
const handleFormSubmit = async (event) => {
  event.preventDefault();
  isSubmitting.value = true;
  submitMessage.value = "";

  try {
    const formData = new FormData(event.target);

    const response = await fetch("https://formspree.io/f/xkgzkgjw", {
      method: "POST",
      body: formData,
      headers: {
        Accept: "application/json",
      },
    });

    if (response.ok) {
      submitSuccess.value = true;
      submitMessage.value =
        "‚úÖ Message envoy√© avec succ√®s ! Nous vous r√©pondrons rapidement.";
      // Reset form
      event.target.reset();
    } else {
      throw new Error("Erreur lors de l'envoi");
    }
  } catch (error) {
    submitSuccess.value = false;
    submitMessage.value =
      "‚ùå Erreur lors de l'envoi. Veuillez r√©essayer plus tard.";
  } finally {
    isSubmitting.value = false;
    // Hide message after 5 seconds
    setTimeout(() => {
      submitMessage.value = "";
    }, 5000);
  }
};

const adjustCounter = (delta) => {
  const newValue = Math.max(0, counterValue.value + delta); // Minimum √† 0

  counterHistory.value.push({
    action: delta > 0 ? `+${delta}` : `${delta}`,
    oldValue: counterValue.value,
    newValue: newValue,
    timestamp: new Date().toLocaleTimeString(),
    type: "counter",
  });
  counterValue.value = newValue;

  // Check for explosion
  if (counterValue.value >= thresholdValue.value) {
    triggerExplosion();
  }
};

const adjustCounterRandom = (type) => {
  let delta;
  if (type === "positive") {
    // Random entre +1 et +5
    delta = Math.floor(Math.random() * 5) + 1;
  } else {
    // Random entre -1 et -5
    delta = -(Math.floor(Math.random() * 5) + 1);
  }
  adjustCounter(delta);
};

const adjustThreshold = (delta) => {
  const newValue = thresholdValue.value + delta;
  if (newValue >= minThreshold.value && newValue <= maxThreshold.value) {
    const oldValue = thresholdValue.value;
    thresholdValue.value = newValue;

    // Enregistrer dans l'historique
    counterHistory.value.push({
      action: delta > 0 ? `Capacit√© +${delta}` : `Capacit√© ${delta}`,
      oldValue: oldValue,
      newValue: newValue,
      timestamp: new Date().toLocaleTimeString(),
      type: "threshold",
    });
  }
};

const adjustThresholdRandom = (type) => {
  let delta;
  if (type === "positive") {
    // Random entre +1 et +5
    delta = Math.floor(Math.random() * 5) + 1;
  } else {
    // Random entre -1 et -5
    delta = -(Math.floor(Math.random() * 5) + 1);
  }
  adjustThreshold(delta);
};

const getCounterPosition = () => {
  // Position du compteur : 0 au bord gauche, 30 au bord droit
  const maxScale = 30;
  const percentage = Math.min((counterValue.value / maxScale) * 100, 100);

  // 0 = 10% (bord gauche), 30 = 90% (bord droit)
  const minLeft = 10; // Position 0 (%)
  const maxLeft = 90; // Position 30 (%)
  return minLeft + (percentage / 100) * (maxLeft - minLeft);
};

const getThresholdPosition = () => {
  // Position du seuil : m√™me √©chelle que le compteur
  const maxScale = 30;
  const percentage = Math.min((thresholdValue.value / maxScale) * 100, 100);

  // 0 = 10% (bord gauche), 30 = 90% (bord droit)
  const minLeft = 10; // Position 0 (%)
  const maxLeft = 90; // Position 30 (%)
  return minLeft + (percentage / 100) * (maxLeft - minLeft);
};

// Handle escape key for modal
const handleEscape = (event) => {
  if (event.key === "Escape") {
    if (showCloseConfirmModal.value) {
      cancelCloseGame();
    } else if (showEndGameModal.value) {
      closeEndGameModal();
    } else if (showAIMode.value) {
      closeAIMode();
    } else if (showAIDifficultyModal.value) {
      closeAIDifficultyModal();
    } else if (showPlayerCountModal.value) {
      closePlayerCountModal();
    } else if (showGameModeModal.value) {
      closeGameModeModal();
    } else if (showCounterMode.value) {
      showCloseConfirmModal.value = true; // Show confirmation instead of direct close
    } else if (showCardModal.value) {
      closeCardModal();
    } else if (showEventModal.value) {
      showEventModal.value = false;
    } else if (showGameStartModal.value) {
      closeGameStartModal();
    }
  }
};

// Event management functions
const initializeEventDeck = () => {
  // Get all events except "Minuteur final"
  const normalEvents = events.filter(
    (event) => event.name !== "Minuteur final"
  );
  const finalEvent = events.find((event) => event.name === "Minuteur final");

  // Shuffle normal events and take 9 (to make 10 total with final event)
  const shuffledEvents = [...normalEvents].sort(() => Math.random() - 0.5);
  const selectedNormalEvents = shuffledEvents.slice(0, 9);

  // Create deck with 10 cards total
  const deck = [...selectedNormalEvents];

  // Insert final event at position 7, 8, or 9 (0-indexed) which corresponds to turns 8, 9, or 10
  const finalPositions = [7, 8, 9]; // Positions 8, 9, 10 in 1-indexed terms
  const finalPosition =
    finalPositions[Math.floor(Math.random() * finalPositions.length)];

  console.log(
    `Carte "Minuteur final" plac√©e √† la position ${finalPosition} (tour ${
      finalPosition + 1
    })`
  );

  // Insert the final event at the chosen position
  deck.splice(finalPosition, 0, finalEvent);

  eventDeck.value = deck;
};

const drawNextEvent = () => {
  if (eventDeck.value.length === 0 || gameOver.value) return;

  turnNumber.value += 1;
  const drawnEvent = eventDeck.value.shift();
  currentEvent.value = drawnEvent;

  // Add timestamp and turn number to the event for history
  const eventWithTimestamp = {
    ...drawnEvent,
    timestamp: new Date().toLocaleTimeString(),
    turn: turnNumber.value,
    type: "event",
  };

  usedEvents.value.push(eventWithTimestamp);
  showEventModal.value = true;
  eventModalPulse.value = true;

  // Check if the final countdown has been revealed
  if (drawnEvent.name === "Minuteur final") {
    finalCountdownRevealed.value = true;
  }

  // Remove pulse effect after 2 seconds
  setTimeout(() => {
    eventModalPulse.value = false;
  }, 2000);
};

const closeEventModal = () => {
  showEventModal.value = false;
};

const endGame = () => {
  // Stop the timer and calculate final duration
  if (gameStartTime.value && !gameOver.value) {
    const now = Date.now();
    const duration = now - gameStartTime.value;
    gameDuration.value = formatDuration(duration);
    gameOver.value = true;
  }
  showEndGameModal.value = true;
};

const closeEndGameModal = () => {
  showEndGameModal.value = false;
};

const startGame = () => {
  showGameStartModal.value = false;
  // Set both times synchronously to ensure they start together
  const now = Date.now();
  gameStartTime.value = now;
  currentTime.value = now;

  // Automatically trigger the first event
  setTimeout(() => {
    drawNextEvent();
  }, 500); // Small delay to ensure modal is closed
};

const closeGameStartModal = () => {
  showGameStartModal.value = false;
  // Don't start timer when just closing the modal
};

const confirmCloseGame = () => {
  showCloseConfirmModal.value = false;
  closeCounterMode();
};

const cancelCloseGame = () => {
  showCloseConfirmModal.value = false;
};

// Game mode selection functions
const openGameModeSelection = () => {
  showGameModeModal.value = true;
  document.body.style.overflow = "hidden";
};
const closeGameModeModal = () => {
  showGameModeModal.value = false;
  document.body.style.overflow = "auto";
};
const selectCompetitiveMode = () => {
  console.log("selectCompetitiveMode called");
  console.log("showPlayerCountModal BEFORE:", showPlayerCountModal.value);
  closeGameModeModal();
  showPlayerCountModal.value = true;
  document.body.style.overflow = "hidden";
  console.log("showPlayerCountModal AFTER:", showPlayerCountModal.value);

  // Force une re-render apr√®s un court d√©lai pour tester
  setTimeout(() => {
    console.log(
      "showPlayerCountModal after timeout:",
      showPlayerCountModal.value
    );
  }, 100);
};
const selectCooperativeMode = () => {
  closeGameModeModal();
  showAIDifficultyModal.value = true;
  document.body.style.overflow = "hidden";
};

// Player count selection functions
const selectPlayerCount = (count) => {
  playerCount.value = count;
  closePlayerCountModal();
  openCounterMode();

  // Ajouter l'initialisation dans l'historique APR√àS l'ouverture du mode
  counterHistory.value.push({
    action: "Initialisation compteur",
    oldValue: 0,
    newValue: count,
    timestamp: new Date().toLocaleTimeString(),
    type: "init",
    icon: "üéØ",
  });
};

const closePlayerCountModal = () => {
  showPlayerCountModal.value = false;
  document.body.style.overflow = "auto";
};

// AI difficulty selection functions
const selectAIDifficulty = (difficulty) => {
  selectedDifficulty.value = difficulty;
  showAIDifficultyModal.value = false;
  document.body.style.overflow = "auto";
  openAIMode();
};
const closeAIDifficultyModal = () => {
  showAIDifficultyModal.value = false;
  document.body.style.overflow = "auto";
};

// AI mode functions
const openAIMode = () => {
  showAIMode.value = true;
  // Initialize AI mode values
  aiCounterValue.value = 0;
  aiThresholdValue.value = selectedDifficulty.value?.threshold || 20;
  aiCounterHistory.value = [];
  aiTurnNumber.value = 0;
  aiShowExplosion.value = false;
  aiGameOver.value = false;
  aiGameStartTime.value = null;
  aiGameDuration.value = null;
  document.body.style.overflow = "hidden";
};
const closeAIMode = () => {
  showAIMode.value = false;
  document.body.style.overflow = "auto";
};

onMounted(() => {
  window.addEventListener("scroll", handleScroll);
  window.addEventListener("keydown", handleEscape);

  // Start timer interval on client side only
  timerInterval = setInterval(() => {
    currentTime.value = Date.now();
  }, 1000);
});

onUnmounted(() => {
  window.removeEventListener("scroll", handleScroll);
  window.removeEventListener("keydown", handleEscape);

  // Clean up timer interval
  if (timerInterval) {
    clearInterval(timerInterval);
    timerInterval = null;
  }
});

// SEO
useHead({
  title: "Boom Badaboom - R√®gles du Jeu | Jeu de cartes √† r√¥les cach√©s",
  meta: [
    {
      name: "description",
      content:
        "D√©couvrez les r√®gles compl√®tes de Boom Badaboom, un jeu de cartes √† r√¥les cach√©s m√™lant bluff, tension et strat√©gie pour 1-5 joueurs.",
    },
    {
      name: "keywords",
      content:
        "Boom Badaboom, jeu de cartes, r√¥les cach√©s, bluff, strat√©gie, r√®gles du jeu",
    },
    { property: "og:title", content: "Boom Badaboom - R√®gles du Jeu" },
    {
      property: "og:description",
      content:
        "Jeu de cartes √† r√¥les cach√©s m√™lant bluff, tension et strat√©gie",
    },
    { property: "og:image", content: "/logo.png" },
    { property: "og:type", content: "website" },
  ],
  link: [
    { rel: "icon", type: "image/svg+xml", href: "/favicon.svg" },
    { rel: "icon", type: "image/png", href: "/logo.png" },
    { rel: "apple-touch-icon", href: "/logo.png" },
    { rel: "shortcut icon", href: "/favicon.ico" },
  ],
});
</script>

<style>
html {
  scroll-behavior: smooth;
}

.scrollbar-hide {
  -ms-overflow-style: none;
  scrollbar-width: none;
}

.scrollbar-hide::-webkit-scrollbar {
  display: none;
}

@media print {
  .nav,
  .back-to-top {
    display: none !important;
  }

  .content {
    box-shadow: none !important;
    margin: 0 !important;
  }
}
</style>
